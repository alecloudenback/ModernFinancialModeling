# Visualizations {#sec-visualization}

## In This Chapter

The evolved brain and pattern recognition, recommended principles for looking at data, and avoiding common mistakes. Exploratory visualization versus visualizations intended for an audience.

```{julia}
#| echo: false
#| output: false
using Pkg
Pkg.activate("env/visualization")
Pkg.instantiate()
```

## Key elements

Visualization is a crucial component in data analysis, statistical modeling, and decision-making for several important reasons. It serves as a bridge between raw data and actionable insights, helping to simplify, explore, and communicate complex information effectively. Here are key reasons why visualization is important:

### Understanding and exploring data

Depending on purposes, different types of plots can help understand underlying relationships in the data. A scatter plot can reveal correlations between two variables, while a histogram can show the distribution of a single variable.
- Pattern Recognition: Visualization helps in identifying trends, patterns, and outliers in data that might not be immediately evident through raw numbers.
- Exploratory Data Analysis (EDA): It allows analysts to explore the data interactively, enabling a better understanding of underlying distributions, relationships, and anomalies before applying formal statistical models.

### Simplifying complex information

Large datasets with many variables or dimensions can be overwhelming. Visualization simplifies complex data by representing it in intuitive visual formats like graphs, charts, and heatmaps. Besides, instead of dealing with thousands of rows of data, a well-designed graph can distill essential information for quick understanding. For example, in multivariate datasets, a principal component analysis (PCA) biplot reduces the dimensions of the data, making it easier to interpret.

### Identifying relationships and correlations

Relationships between variables, such as correlation, dependency, or causality, can be better understood through visualizations like scatter plots, line graphs, and network diagrams. For example, a heatmap can show the strength of correlations between multiple variables, helping in the selection of important features for modeling.

### Supporting decision making

Visualization aids decision-makers by presenting data in a clear and actionable form, often enabling quicker and more informed decisions. By visualizing risks, such as potential financial losses, decision-makers can understand the range of possible outcomes and make better choices. For example, visualizing portfolio risk through VaR (Value at Risk) or loss distributions helps in assessing potential future losses.

### Effective communication

A good visualization is a powerful tool for communicating insights to stakeholders, especially non-technical audiences, in a way that is easy to grasp. It can also be used to tell a compelling story by emphasizing important findings and making the data more engaging. A time-series line chart can tell the story of stock price movements over time, showing trends and volatility to investors.

### Spotting anomalies and outliers

Anomalies, such as errors or unexpected behaviors in data, are easier to spot with visual representations like box plots, scatter plots, or time series graphs. This can be applied in fraud detection, where visualizing transactions over time can reveal unusual spikes or patterns that may indicate fraudulent activity.

### Interactive exploration

Interactive visualizations, like those created using tools such as Tableau or Plotly in Python/Julia, allow users to zoom in on areas of interest, filter data, and dynamically explore different views of the data. This enables users to adjust parameters, select specific variables, or focus on different time frames, leading to more personalized insights. Interactive dashboards let business analysts explore sales trends by geography, time, or product category in real-time.

### Enhancing models and hypotheses

Visualizing the results of statistical models (such as regression, classification, or clustering) allows for easier validation and refinement of models. It can also be used to compare model predictions with actual outcomes, identifying where the model performs well or poorly. For example a residual plot can help diagnose model fit in a regression analysis, highlighting whether the errors are randomly distributed or exhibit patterns.

### Handling large datasets

Visualization can handle large datasets by summarizing the data in visual formats, providing a way to understand vast amounts of information quickly. This can be applied in machine learning, where feature importance can be visualized across many features, helping data scientists to focus on the most critical variables for prediction.

### Revealing hidden structures in data

Techniques like clustering and dimensionality reduction can reveal hidden structures in data, such as natural groupings or latent variables, which become apparent only when visualized. For one application in unsupervised learning, visualizing clusters from a k-means algorithm can show the natural grouping of customers in a marketing dataset.

### Fostering collaboration

Visualization helps to bridge communication gaps between different teams (technical, business, management), enabling better collaboration. A dashboard summarizing KPIs (key performance indicators) for different departments can help teams across the organization align with the same goals.

## Types of visualization tools

- Basic Charts and Graphs: Bar charts, line graphs, scatter plots, histograms, pie charts.
    + Bar charts are best for comparing categorical data or discrete values across different categories. Sometimes categories can be grouped for a stacked bar chart to show for example how each category changes over time.
    + Line graphs are best for showing trends over time or when we want to highlight the rate of change. It is very intuitive to use line graphs to track trends or patterns.
    + Scatter plots are best for showing relationships or correlations between two variables. It is used a lot when one looks for patterns, clusters or outliers, or would like to explore the distribution of data points across different dimensions.
    + Histograms are best for showing the distribution of a single continuous variable, or visualizing the distribution of data points across different ranges or intervals.
    + Pie charts are best for showing parts of a whole or proportional data. It is often used when one has fewer categories (typically 3-5) that sum to 100%.

```{julia}
using Random, CairoMakie

# Data for the plots
categories = ["Product A", "Product B", "Product C", "Product D"]
sales = [150, 250, 200, 300]  # For bar chart

months = 1:12
sales_growth = [120, 150, 170, 180, 200, 220, 210, 230, 250, 270, 290, 310]  # For line graph

Random.seed!(1234)
x = rand(100)  # For scatter plot

proportions = [30, 25, 15, 30]  # For pie chart

# Combine individual plots into a 2x2 layout
f = Figure()
barplot(f[1, 1], 1:4, sales, axis=(xticks=(1:4, categories), title="bar"))
axis = Axis(f[1, 2], title="line")
lines!(f[1, 2], months, sales_growth)
axis = Axis(f[2, 1], title="scatter")
scatter!(axis, x)
axis = Axis(f[2, 2], title="pie")
pie!(axis, proportions, color=[:yellow, :orange, :red, :blue])
f
```

- Multivariate Visualizations: Heatmaps, parallel coordinates plots, radar charts, bubble charts.
    + Heatmaps are best for visualizing the intensity, interactions or relationships of values across two dimensions.
    + Bubble charts which are variants of scatter plots are best for showing relationships between three variables. One can easily highlight relative importance or magnitude using the size of bubbles (e.g., revenue, population).
    + Parallel coordinates plots are best for comparing multiple variables across different observations. They are often used for detecting patterns, correlations or relationships across multiple dimensions.
    + Radar charts are best for comparing multiple variables for a single or few observations, especially when one needs to show comparisons of several quantitative variables for one or more items, with each variable represented on an axis.

```{julia}
using Random, CairoMakie

Random.seed!(1234)

# Data for plots
z = rand(10, 10) # For heatmap
bubble_x = rand(10) * 10
bubble_y = rand(10) * 10
bubble_size = rand(10) * 100

# Dummy data for radar chart
radar_data = [0.7, 0.9, 0.4, 0.6, 0.8]
radar_labels = ["A", "B", "C", "D", "E"]

# Dummy data for parallel coordinates plot
parallel_data = rand(10, 5)
parallel_color = [:green, :orange, :red, :blue, :purple]

f = Figure()

# Heatmap (1,1)
ax1 = Axis(f[1, 1], title="Heatmap")
heatmap!(ax1, z)

# Parallel coordinates (1,2)
ax2 = Axis(f[1, 2], title="Parallel Coordinates")
for i in 1:size(parallel_data, 2)
    lines!(ax2, 1:size(parallel_data, 2), parallel_data[i, :], color=parallel_color[i])
end
ax2.xticks = (1:5, radar_labels)

# Radar Chart (2,1)
ax3 = Axis(f[2, 1], title="Radar Chart", aspect=1)
angles = range(0, 2π, length=length(radar_data) + 1)
r = [radar_data; radar_data[1]]
arc!(ax3, Point2f(0), 0.5, -π, π, color=:orange)
arc!(ax3, Point2f(0), 1, -π, π, color=:orange)
lines!(ax3, [-1, 1], [1, -1], color=:orange)
lines!(ax3, [-1, 1], [-1, 1], color=:orange)
lines!(ax3, cos.(angles) .* r, sin.(angles) .* r, color=:green)
poly!(ax3, cos.(angles) .* r, sin.(angles) .* r, color=(:blue, 0.2))
scatter!(ax3, cos.(angles) .* r, sin.(angles) .* r, color=:red)

# Bubble Plot (2,2)
ax4 = Axis(f[2, 2], title="Bubble Plot")
scatter!(ax4, bubble_x, bubble_y, markersize=bubble_size, color=:orange)

f
```

- Dimensionality Reduction: PCA plots, t-SNE, and UMAP for visualizing high-dimensional data. Here we show an example how high-dimensional data can be shown on a t-SNE plot.

```{julia}
using TSne, Statistics, MLDatasets, CairoMakie

alldata, allabels = MNIST(split=:train)[:];
data = reshape(permutedims(alldata[:, :, 1:2500], (3, 1, 2)), 2500, size(alldata, 1) * size(alldata, 2));

# Normalize the data, this should be done if there are large scale differences in the dataset
rescale(A; dims=1) = (A .- mean(A, dims=dims)) ./ max.(std(A, dims=dims), eps())

X = rescale(data, dims=1);

Y = tsne(X, 2, 50, 1000, 20.0);

f = Figure()
axis = Axis(f[1, 1])
scatter!(axis, Y[:, 1], Y[:, 2], color=Int.(allabels[1:size(Y, 1)]))
f
```

- Time Series Visualization: Line charts, area charts, time-series decomposition plots. Refer to @sec-datalearning for a time series plot.

- Geospatial Visualization: Maps, choropleth maps for visualizing spatial data. Here we show how spatial data can be visualized using a choropleth map.

```{julia}
using VegaLite, VegaDatasets

us10m = dataset("us-10m")
unemployment = dataset("unemployment")

@vlplot(
    :geoshape,
    width = 500, height = 300,
    data = {
        values = us10m,
        format = {
            type = :topojson,
            feature = :counties
        }
    },
    transform = [{
        lookup = :id,
        from = {
            data = unemployment,
            key = :id,
            fields = ["rate"]
        }
    }],
    projection = {
        type = :albersUsa
    },
    color = "rate:q"
)
```

- Interactive Dashboards: Tools like Tableau, Power BI, Pluto for interactive and dynamic data exploration.

## Julia packages

Julia has several powerful packages for data visualization, each with different strengths depending on your needs (e.g., interactive vs. static plots, ease of use vs. customization). Below are some of the most common visualization packages in Julia:

### Makie.jl

`Makie` is designed for high-performance, interactive, and 3D visualization. It supports real-time interaction and is highly customizable. It supports 2D and 3D plotting and real-time interactivity. It is also extremely fast with GPU acceleration for certain operations.

### Plots.jl

`Plots` is one of the most versatile and popular Julia plotting libraries. It provides a high-level interface for different plotting backends (e.g., GR, Plotly, PyPlot, PGFPlotsX, etc.). It uses a high-level syntax, easy to use. It supports multiple backends for both static and interactive plots with extensive customization options.

### Gadfly.jl

`Gadfly` is a grammar-of-graphics plotting system similar to ggplot2 in R. It is very flexible for producing static visualizations. It supports grammar of graphics syntax, great for statistical graphics. It is also easy to learn, especially for users familiar with `ggplot2`. Besides it is good for quick prototyping and publication-quality plots.

### PlotlyJS.jl

`PlotlyJS` is the Julia wrapper for the interactive `Plotly.js` library. It provides rich interactive visualizations with support for hover information, zooming, and more. It is great for interactive web-based visualizations. It supports a wide range of plot types including 3D, maps, and more, and can be used for building dashboards.

### VegaLite.jl

`VegaLite` is a wrapper for the Vega-Lite visualization grammar, which focuses on interactive, declarative visualizations. It works well for complex, layered visualizations. It is grammar-of-graphics based which easily produces interactive charts. It is built for declarative specification of visualizations.

### PyPlot.jl

`PyPlot` is a Julia wrapper for the popular Python `matplotlib` library. It's suitable for users familiar with Python who want the same plotting capabilities in Julia. It leverages the full capabilities of matplotlib and it can produce high-quality, publication-ready plots. It is great for scientific visualization.

### StatsPlots.jl

`StatsPlots` extends `Plots` by adding statistical plot types such as boxplots, violin plots, histograms, and density plots. It's ideal for users who frequently work with statistical data. It is specialized for statistical visualizations. It allows easy integration with Julia’s statistical packages like `DataFrames` and `StatsBase`.

### GraphPlot.jl

This package is used to plot graphs (networks), such as social network visualizations or other graph-related problems. It supports integration with the `LightGraphs` package for graph analytics.

### UnicodePlots.jl

`UnicodePlots` provides simple plotting capabilities in the terminal using Unicode characters, making it lightweight and fast. There are no external dependencies. It is great for quick plotting within the terminal.

Each package has unique strengths depending on the use case, so the best choice depends on our specific needs, the type of data, and whether we need interactive or static visualizations.
